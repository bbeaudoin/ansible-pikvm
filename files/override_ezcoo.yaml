---
###############################################################################
#                                                                             #
#  Override KVMD settings.                                                    #
#                                                                             #
#    * https://docs.pikvm.org/first_steps/#structure-of-configuration-files   #
#                                                                             #
#  This file uses YAML syntax. All overridden parameters will be applied      #
#  AFTER other configs and "!include" directives, and BEFORE validation.      #
#  Values should be combined under common sections.                           #
#                                                                             #
###############################################################################
#
#########
# Wrong #
#########
# kvmd:
#   gpio:
#     drivers: ...
# kvmd:
#   gpio:
#     scheme: ...
#
###########
# Correct #
###########
# kvmd:
#   gpio:
#     drivers: ...
#     scheme: ...
#
###########
# Example #
###########
# vnc:
#   # See https://docs.pikvm.org/vnc
#   keymap: /usr/share/kvmd/keymaps/ru # Set russian keymap
#   auth:
#     vncauth:
#       enabled: true # Enable auth via /etc/kvmd/vncpasswd

kvmd:
  gpio:
    drivers:
      # ezcoo KVM Switch Driver
      ez:
        type: ezcoo
        protocol: 2
        device: /dev/ttyUSB0

      # Wake on Lan (WoL) Driver
      wol_server0:
        type: wol
        mac: 7c:10:c9:b8:ee:13
      wol_server1:
        type: wol
        mac: f0:2f:74:c3:78:26

      # Commands to restart, reboot, or poweroff
      pikvm_restart:
        type: cmd
        cmd: [/usr/bin/sudo, /usr/bin/systemctl, restart, kvmd]
      pikvm_reboot:
        type: cmd
        cmd: [/usr/bin/sudo, /usr/bin/reboot]
      pikvm_poweroff:
        type: cmd
        cmd: [/usr/bin/sudo, /usr/bin/poweroff]
    scheme:
      # Indicators for active KVM switch inputs/outputs
      ch0_led:
        driver: ez
        pin: 0
        mode: input
      ch1_led:
        driver: ez
        pin: 1
        mode: input
      ch2_led:
        driver: ez
        pin: 2
        mode: input
      ch3_led:
        driver: ez
        pin: 3
        mode: input

      # Control button definitions for KVM switch
      ch0_button:
        driver: ez
        pin: 0
        mode: output
        switch: false
      ch1_button:
        driver: ez
        pin: 1
        mode: output
        switch: false
      ch2_button:
        driver: ez
        pin: 2
        mode: output
        switch: false
      ch3_button:
        driver: ez
        pin: 3
        mode: output
        switch: false

      # Buttons for WoL
      wol_server0:
        driver: wol_server0
        pin: 0
        mode: output
        switch: false
      wol_server1:
        driver: wol_server1
        pin: 0
        mode: output
        switch: false

      # Definitions for PiKVM LED, reboot, and restart buttons
      pikvm_led:
        pin: 0
        mode: input

      pikvm_restart:
        driver: pikvm_restart
        pin: 0
        mode: output
        switch: false

      pikvm_reboot:
        driver: pikvm_reboot
        pin: 0
        mode: output
        switch: false

      pikvm_poweroff:
        driver: pikvm_poweroff
        pin: 0
        mode: output
        switch: false

    view:
      # Table that will be shown when GPIO menu is opened
      table:
        - ["#MiniPC", ch0_led, ch0_button, wol_server0 | WoL]
        - ["#MiniPC", ch1_led, ch1_button, wol_server1 | WoL]
        - ["#PiKVM", ch2_led, ch2_button]
        - ["#Spare", ch3_led, ch3_button]
        - ["#PiKVM", pikvm_led|green, pikvm_restart|confirm|Restart, pikvm_reboot|confirm|Reboot, pikvm_poweroff|confirm|Shutdown]
